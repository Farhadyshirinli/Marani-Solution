@model ContactPostInfoViewModel

@{
    ViewData["Title"] = "Contact";
}


<partial name="_MainMenu" />
<!-- Page Add Section Begin -->
<section class="page-add">
    <div class="container">
        <div class="row">
            <div class="col-lg-4">
                <div class="page-breadcrumb">
                    <h2>Contact us<span>.</span></h2>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- Page Add Section End -->
<!-- Contact Section Begin -->
<div class="contact-section">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <form id="contact-form" class="contact-form" method="post" novalidate>
                    @if (@ViewBag.Message != null)
                    {
                        <div class="alert-success">
                            @ViewBag.Message
                        </div>
                    }
                    <div class="row">
                        <div class="col-lg-6">
                            <input asp-for="@Model.ContactPosts.Name" placeholder="First Name" />
                            <span asp-validation-for="@Model.ContactPosts.Name" class="alert-danger"></span>
                        </div>
                        <div class="col-lg-6">
                            <input asp-for="@Model.ContactPosts.Surname" -for placeholder="Surname">
                            <span asp-validation-for="@Model.ContactPosts.Surname" class="alert-danger"></span>

                        </div>
                        <div class="col-lg-12">
                            <input asp-for="@Model.ContactPosts.Email" type="Email" placeholder="E-mail" />
                            <span asp-validation-for="@Model.ContactPosts.Email" class="alert-danger"></span>
                        </div>
                        <div class="col-lg-12">
                            <input asp-for="@Model.ContactPosts.Subject" placeholder="Subject">
                            <span asp-validation-for="@Model.ContactPosts.Subject" class="alert-danger"></span>
                        </div>
                        <div class="col-lg-12">
                            <textarea asp-for="@Model.ContactPosts.Message" placeholder="Message"></textarea>
                            <span asp-validation-for="@Model.ContactPosts.Message" class="alert-danger"></span>
                        </div>

                        <div class="col-lg-12 text-right">
                            <button type="submit">Send message</button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-lg-3 offset-lg-1">
                <div class="contact-widget">
                    <div class="cw-item">
                        <h5>Location</h5>
                        <ul>
                            @Model.ContactInfos.Location
                        </ul>
                    </div>
                    <div class="cw-item">
                        <h5>Phone</h5>
                        <ul>
                            @Model.ContactInfos.PhoneNumber
                        </ul>
                    </div>
                    <div class="cw-item">
                        <h5>E-mail</h5>
                        <ul>
                            @Model.ContactInfos.CompanyEmail
                            <li></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="map">
            <div class="row">
                <div class="col-lg-12">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d11895.389437786405!2d45.720441298226206!3d41.81004853528088!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x40467fe04b1ab8d1%3A0x18362c0eb381d8f8!2sMukuzani%20Wine%20Cellar!5e0!3m2!1sen!2saz!4v1678657111417!5m2!1sen!2saz"
                            height="560" style="border:0;" allowfullscreen=""></iframe>
                     </div>
            </div>
        </div>
    </div>
</div>
<!-- Contact Section End -->
<!-- Footer Section Begin -->
<partial name="_FooterWidget" />
<!-- Footer Section End -->
@section addcss{
    <link rel="stylesheet" href="~/libs/toastr.js/toastr.min.css" />
    <style>
        input[name].novalidate
        textarea[name].novalidate {
            border: 1px solid rgb(220,53,69);
        }
    </style>
                }

    @section addjs{
    <script src="~/libs/toastr.js/toastr.min.js"></script>
    <script src="~/libs/toastr.js/toastr.customize.js"></script>



    <script>
        $(document).ready(function () {
            $('#contact-form').submit(function (ev) {
                ev.preventDefault();
                console.log(ev.currentTarget)

                let fd = new FormData(ev.currentTarget);

                $.ajax({
                    url: '@Url.Action("Contact")',
                    type: 'POST',
                    data: fd,
                    processData: false,
                    contentType: false,
                    success: function (response) {

                        $('#contact-form span.alert-danger').remove();
                        $('#contact-form input[name],#contact-form textarea[name]').removeClass('novalidated');
                        console.log(response, 'SUCCESS');

                        if (response.error == true) {
                            toastr.error(response.message, 'Xeta');
                            showErrors(response.state)
                            return;
                        }

                        toastr.success(response.message, 'Ugur');
                        ev.currentTarget.reset();
                    },


                    error: function (response) {
                        console.log(response, 'ERROR');
                    }


                });

            })

        });


        function showErrors(state) {
            let form = $('#contact-form');

            state.forEach(item => {

                let errorInput = $(`#contact-form input[name=${item.fieldName}],#contact-form textarea[name=${item.fieldName}]`);
                let errorSpan = $('<span/>', {
                    class: 'alert-danger',
                    html: item.message
                });

                $(errorInput.parent()).append(errorSpan);
                $(errorInput).addClass('novalidated');

            });


        };

    </script>
}





